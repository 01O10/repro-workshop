---
title: An exploration of computer facilitated free time activities over the last decade
author: "UKE Hamburg Workshop on Reproducibility"
date: "2021-03-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Acknowledgement

The idea for the data stems from the [tidytuesday initiative](https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-03-16/readme.md); the data was scraped for [kaggle](https://www.kaggle.com/michau96/popularity-of-games-on-steam) from [steamcharts.com](https://steamcharts.com/).
The code and graphics were adapted from [Ingrid Zoll's tidytuesday submission](https://itlzoll.netlify.app/post/tidy-tuesday-march-16/).

```{r libraries, message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(scales)
library(pander)
conflicted::conflict_prefer("filter", "dplyr")
```

```{r loading data, message=FALSE, warning=FALSE, results='hide'}
# Get the Data
games <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-16/games.csv') %>% 
  mutate(date = my(str_c(month, "_", year)))
```

If we just average across time for each game and correlate average and peak simultaneous gamers, we get a a between game correlation.

```{r}
games %>% 
  group_by(gamename) %>% 
  summarise(across(c(avg, peak), mean), .groups = "drop") %>% 
  with(cor.test(avg, peak)) %>% 
  pander()
```

```{r}
within_cor <- games %>% 
  group_by(gamename) %>% 
  summarise(cor = cor(avg, peak)) %>% 
  pull(cor) %>% 
  mean()
```

If we instead correlate average and peak simultaneous gamers for each game separate and then average, we get a within game correlation of `r round(within_cor, 4)` (remember this is a somewhat crude and a real multilevel/mixed effect model would be state of the art).

```{r by month popularity, message=FALSE, warning=FALSE}
mostpop_bymonth <- games %>%
  group_by(date)%>% 
  top_n(3, avg) %>% 
  ungroup %>%
  add_count(gamename, name = "count") %>%
  mutate(label = gamename, label = case_when(
    count < 10 ~ "Other games",
    count > 10 ~ gamename)) %>%
  mutate(game = factor(label), game = fct_infreq(label)) %>%
  mutate(game = str_replace(game, "PLAYERUNKNOWN'S BATTLEGROUNDS", "PUBG"), 
         game = str_replace(game, "Counter-Strike: Global Offensive", "CS GO"))
```

```{r}
ggplot(mostpop_bymonth, aes(x=date, y=avg, color=game))+
  geom_line()+
  theme_minimal() +
  labs(caption = "PUBG = PlayerUnknown's BattleGround \nCS GO = Counter-Strike: Global Offensive",
       title= "The Three Most Popular Games on Steam by Month", 
       y="Average number of players at the same time", x="Date") +
  scale_y_continuous(labels = unit_format(unit = "M", scale = 1e-6))
```

```{r, message=FALSE, warning=FALSE}
populargames <- mostpop_bymonth %>%
  filter(game == "CS GO" | game == "PUBG"| game == "Dota 2")
```

```{r}
ggplot(populargames, aes(x=date, y=avg))+
  geom_linerange(aes(ymax=peak, ymin=avg, color=game), size=.25)+
  geom_point(aes(y=peak, color=game), size=.7)+
  geom_point(aes(y=avg, color=game), size=.7)+
  theme_minimal() +
  labs(title="Three Most Popular Games", x="Date", y="Number of players") +
  scale_y_continuous(labels = unit_format(unit = "M", scale = 1e-6))
```

